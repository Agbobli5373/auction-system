<% layout('layouts/boilerplate') %> 

<div class="product-container">
    <div class="image-container">
        <% for (let image of product.images){  %> 
            <img class="product__image" src="<%= image.path %> ">
        <% }%>
    </div>

    <div class="product-details">
        <h1><%= product.title %> </h1>
        <p><%= product.description %></p>
        <p>Category</p>
        <p>Base Price</p>
        <p>Current Price</p>
        <form action="">
            <input type="number" name="" id="">
            <button>Submit</button>
        </form>
        <form action="">
            <button>Quick Bid</button>
        </form>
    </div>
</div>


<h3>Title</h3>
<p><%= product.title %> </p>
<h3>Description</h3>
<p><%= product.description %></p>
<h3>Category</h3>
<p><%= product.category %> </p>
<h3>Base Price</h3>
<p> &#8377; <%= product.basePrice %> </p>

<div id="bid-container">
    <% if(product.currentHighestBid.amount){ %>
        <h3>Current Highest Bid</h3>
        <p>&#8377; <%= product.currentHighestBid.amount %></p>
    <% } %> 
</div>

<div id="submit-bid">
    <form action="/users/<%= product._id %>/bid" method="post">
        <input type="number" min="<%= product.currentHighestBid.amount + 100 || product.basePrice + 100 %>" name="amount" placeholder="Enter your bid" required>
        <button class="btn btn-success" type="submit">Submit Bid</button>
    </form>
    <form action="/users/<%= product._id %>/bid" method="post">
        <input type="text" name="amount" value="<%= product.currentHighestBid.amount + 100 || product.basePrice + 100 %>" hidden>
        <button class="btn btn-primary" type="submit">Quick Bid <%= product.currentHighestBid.amount + 100 || product.basePrice + 100 %></button>
    </form>
</div> 

<h3>Start Time</h3>
<p class="startTime"><%= product.startTime %> </p>
<h3>Duration</h3>
<p><%= product.duration %> Days</p>
<h3>Listed by</h3>
<a href="/users/<%= product.user?._id || '#' %>"><%= product.user?.firstName || 'Deleted User'%></a>
<hr>
<h1>Time Remaining</h1>
<p id="timer"></p>

<br>
<% if(currentUser && product.user?._id.equals(currentUser)){ %>
    <a href="/products/<%= product._id %>/edit">Edit Product</a>
    <form action="/products/<%= product._id %>?_method=DELETE" method="post">
        <button type="submit">Delete Product</button>
    </form>
<% } %>

<!-- In this div I will dynamically add the contact-seller button and checkout button-->
<div id="contact-seller"></div>

<script>
    const NODE_ENV = '<%= process.env.NODE_ENV %>';
    let startTime = '<%- product.startTime %>';
    let endTime = '<%- product.endTime %>';
    const duration = '<%- product.duration %>';
    let highestBidInfo = '<%- JSON.stringify(product.currentHighestBid).replace(/[\/\(\)\']/g, "&apos;") %>';
    let auctionStatus = '<%- product.auctionStatus %>';
    const productId = '<%- product._id %>';
    let loggedinUserId = '<%- JSON.stringify(currentUser)%>';
</script> 
<script src="/js/product/productPage.js"></script>